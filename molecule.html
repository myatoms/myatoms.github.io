<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Molecule Simulator - Static Educational Version</title>
  <script src="https://3Dmol.org/build/3Dmol-min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #000000; /* all black */
      color: white;
    }
    #controls {
      width: 300px;
      padding: 15px;
      background-color: #0f1724;
      box-sizing: border-box;
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      overflow-y: auto;
    }
    #viewer {
      position: absolute;
      left: 300px;
      top: 0;
      right: 0;
      bottom: 0;
    }
    input[type="text"] {
      width: 100%;
      padding: 6px;
      margin-top: 5px;
      margin-bottom: 10px;
      border-radius: 5px;
      border: 1px solid #444;
      background-color: #071023;
      color: #fff;
    }
    button {
      padding: 8px 12px;
      border-radius: 5px;
      border: none;
      background-color: #12a4ff;
      color: #002234;
      font-weight: 600;
      cursor: pointer;
      margin-bottom: 10px;
    }
    label {
      display: block;
      margin-top: 10px;
      margin-bottom: 3px;
      font-size: 14px;
      color: #bcdff8;
    }
    .toggle {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-top: 5px;
    }
    .small {
      font-size: 12px;
      color: #9dbadf;
    }
  </style>
</head>
<body>
  <div id="controls">
    <h2>Molecule Simulator</h2>
    <label>Molecule name or formula:</label>
    <input id="molInput" type="text" placeholder="H2O, CH4, NH3, CO2..." value="H2O">
    <button id="confirmBtn">Render Molecule</button>

    <div class="toggle">
      <input type="checkbox" id="showLabels" checked>
      <label for="showLabels" class="small">Show atom labels</label>
    </div>
    <div class="toggle">
      <input type="checkbox" id="showBonds" checked>
      <label for="showBonds" class="small">Show bonds</label>
    </div>

    <div class="small">
      <p>Static educational 3D visualization. Atoms are displayed with approximate covalent radii. Nuclei shown in red/transparent. Bonds are cylinders.</p>
    </div>
  </div>

  <div id="viewer"></div>

  <script>
    const viewer = $3Dmol.createViewer("viewer", { backgroundColor: "black", antialias: true });
    
    const covalentRadii = { H: 0.31, C: 0.76, N: 0.71, O: 0.66, F: 0.57, P: 1.07, S: 1.05, Cl: 1.02 };
    const elementColors = { H: "#FFFFFF", C: "#808080", N: "#3050F8", O: "#FF0D0D", P: "#FFA500", S: "#FFFF30", Cl: "#1FF01F" };

    const nameMap = {
      'water':'H2O', 'dihydrogen oxide':'H2O',
      'methane':'CH4','ammonia':'NH3','carbon dioxide':'CO2',
      'ethanol':'C2H6O'
    };

    let atoms = [];
    let bonds = [];

    function parseInput(input) {
      input = input.trim().toLowerCase();
      if(nameMap[input]) input = nameMap[input];
      input = input.replace(/\s+/g,'');
      const re = /([A-Z][a-z]?)(\d*)/g;
      input = input.replace(/([a-z]{1,2})(\d*)/g, (m, el, n) => el.length === 2 ? el[0].toUpperCase() + el[1].toLowerCase() : el.toUpperCase() + n);
      let m; let parsed = [];
      while((m = re.exec(input)) !== null) {
        const el = m[1]; const cnt = m[2]?parseInt(m[2]):1;
        parsed.push({el,cnt});
      }
      let atomList = [], id=0;
      parsed.forEach(p => { for(let i=0;i<p.cnt;i++) atomList.push({id:id++, elem:p.el}); });
      return atomList;
    }

    function initializeMolecule(atomList) {
      atoms = []; bonds = [];
      // scatter atoms roughly in space
      const spacing = 1.5;
      atomList.forEach((a,i) => {
        const angle = i * (2*Math.PI/atomList.length);
        const x = spacing * Math.cos(angle);
        const y = spacing * Math.sin(angle);
        const z = (i % 2) * spacing * 0.5;
        atoms.push({ id:a.id, elem:a.elem, pos:{x,y,z} });
      });
      // simple heuristic bonds (linear chain)
      for(let i=0;i<atoms.length-1;i++) {
        bonds.push({a:i,b:i+1});
      }
    }

    function renderMolecule() {
      viewer.removeAllShapes();
      viewer.removeAllLabels();
      const showLabels = document.getElementById("showLabels").checked;
      const showBonds = document.getElementById("showBonds").checked;

      // draw nuclei (red transparent)
      atoms.forEach(at => {
        viewer.addSphere({center: at.pos, radius: 0.25, color:"#FF0000", alpha:0.5});
      });

      // draw atoms on top
      atoms.forEach(at => {
        const color = elementColors[at.elem] || "#CCCCCC";
        const radius = covalentRadii[at.elem]? covalentRadii[at.elem]*0.3 : 0.3;
        viewer.addSphere({center: at.pos, radius: radius, color: color});
        if(showLabels) viewer.addLabel(at.elem, {position: at.pos, backgroundColor:'rgba(0,0,0,0.6)', fontColor:'#fff', fontSize:12});
      });

      if(showBonds) {
        bonds.forEach(b => {
          const a = atoms[b.a], c = atoms[b.b];
          viewer.addCylinder({start:a.pos,end:c.pos,radius:0.08,color:"#AAAAAA"});
        });
      }

      viewer.zoomTo();
      viewer.render();
    }

    document.getElementById("confirmBtn").addEventListener("click", () => {
      const atomList = parseInput(document.getElementById("molInput").value);
      if(!atomList) return alert("Cannot parse molecule.");
      initializeMolecule(atomList);
      renderMolecule();
    });

    // initial demo
    const demoAtoms = parseInput("H2O");
    initializeMolecule(demoAtoms);
    renderMolecule();

    window.addEventListener("resize", ()=>{
      const v = document.getElementById("viewer");
      viewer.setSize(v.clientWidth, v.clientHeight);
      viewer.render();
    });
  </script>
</body>
</html>
